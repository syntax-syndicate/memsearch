
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="OpenClaw's memory, everywhere — markdown-first semantic memory backed by Milvus">
      
      
      
        <link rel="canonical" href="https://zilliztech.github.io/memsearch/claude-plugin/">
      
      
        <link rel="prev" href="../integrations/">
      
      
      
        
      
      
      <link rel="icon" href="../assets/logo-icon.jpg">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Claude Code Plugin - memsearch</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Code:300,300i,400,400i,700,700i%7CFira+Code:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Fira Code";--md-code-font:"Fira Code"}</style>
      
    
    
      <link rel="stylesheet" href="../stylesheets/terminal.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="deep-orange">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#claude-code-plugin" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="memsearch" class="md-header__button md-logo" aria-label="memsearch" data-md-component="logo">
      
  <img src="../assets/logo-icon.jpg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            memsearch
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Claude Code Plugin
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/zilliztech/memsearch" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    zilliztech/memsearch
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../getting-started/" class="md-tabs__link">
        
  
  
    
  
  Getting Started

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../architecture/" class="md-tabs__link">
        
  
  
    
  
  Architecture

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../python-api/" class="md-tabs__link">
        
  
  
    
  
  Python API

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../cli/" class="md-tabs__link">
        
  
  
    
  
  CLI Reference

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../integrations/" class="md-tabs__link">
        
  
  
    
  
  Integrations

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    <li class="md-tabs__item md-tabs__item--active">
      <a href="./" class="md-tabs__link">
        
  
  
    
  
  Claude Code Plugin

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="memsearch" class="md-nav__button md-logo" aria-label="memsearch" data-md-component="logo">
      
  <img src="../assets/logo-icon.jpg" alt="logo">

    </a>
    memsearch
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/zilliztech/memsearch" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    zilliztech/memsearch
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../getting-started/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Getting Started
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../python-api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Python API
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../cli/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CLI Reference
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../integrations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Integrations
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Claude Code Plugin
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Claude Code Plugin
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#what-it-does" class="md-nav__link">
    <span class="md-ellipsis">
      
        What It Does
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quick-start" class="md-nav__link">
    <span class="md-ellipsis">
      
        Quick Start
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Quick Start">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#install-from-marketplace-recommended" class="md-nav__link">
    <span class="md-ellipsis">
      
        Install from Marketplace (recommended)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#development-mode" class="md-nav__link">
    <span class="md-ellipsis">
      
        Development mode
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-it-works" class="md-nav__link">
    <span class="md-ellipsis">
      
        How It Works
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="How It Works">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lifecycle-diagram" class="md-nav__link">
    <span class="md-ellipsis">
      
        Lifecycle Diagram
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hook-summary" class="md-nav__link">
    <span class="md-ellipsis">
      
        Hook Summary
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-each-hook-does" class="md-nav__link">
    <span class="md-ellipsis">
      
        What Each Hook Does
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="What Each Hook Does">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sessionstart" class="md-nav__link">
    <span class="md-ellipsis">
      
        SessionStart
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#userpromptsubmit" class="md-nav__link">
    <span class="md-ellipsis">
      
        UserPromptSubmit
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stop" class="md-nav__link">
    <span class="md-ellipsis">
      
        Stop
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sessionend" class="md-nav__link">
    <span class="md-ellipsis">
      
        SessionEnd
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#progressive-disclosure" class="md-nav__link">
    <span class="md-ellipsis">
      
        Progressive Disclosure
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Progressive Disclosure">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#l1-auto-injected-automatic" class="md-nav__link">
    <span class="md-ellipsis">
      
        L1: Auto-Injected (Automatic)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#l2-on-demand-expand" class="md-nav__link">
    <span class="md-ellipsis">
      
        L2: On-Demand Expand
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#l3-transcript-drill-down" class="md-nav__link">
    <span class="md-ellipsis">
      
        L3: Transcript Drill-Down
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-the-jsonl-looks-like" class="md-nav__link">
    <span class="md-ellipsis">
      
        What the JSONL Looks Like
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#session-anchors" class="md-nav__link">
    <span class="md-ellipsis">
      
        Session Anchors
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memory-storage" class="md-nav__link">
    <span class="md-ellipsis">
      
        Memory Storage
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Memory Storage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#directory-structure" class="md-nav__link">
    <span class="md-ellipsis">
      
        Directory Structure
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-memory-file" class="md-nav__link">
    <span class="md-ellipsis">
      
        Example Memory File
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#markdown-is-the-source-of-truth" class="md-nav__link">
    <span class="md-ellipsis">
      
        Markdown Is the Source of Truth
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#comparison-with-claude-mem" class="md-nav__link">
    <span class="md-ellipsis">
      
        Comparison with claude-mem
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Comparison with claude-mem">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-key-insight-automatic-vs-agent-driven-recall" class="md-nav__link">
    <span class="md-ellipsis">
      
        The Key Insight: Automatic vs. Agent-Driven Recall
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#comparison-with-claudes-native-memory" class="md-nav__link">
    <span class="md-ellipsis">
      
        Comparison with Claude's Native Memory
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Comparison with Claude&#39;s Native Memory">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#why-this-matters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Why This Matters
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#plugin-files" class="md-nav__link">
    <span class="md-ellipsis">
      
        Plugin Files
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Plugin Files">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#file-descriptions" class="md-nav__link">
    <span class="md-ellipsis">
      
        File Descriptions
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-memsearch-cli" class="md-nav__link">
    <span class="md-ellipsis">
      
        The memsearch CLI
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#what-it-does" class="md-nav__link">
    <span class="md-ellipsis">
      
        What It Does
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quick-start" class="md-nav__link">
    <span class="md-ellipsis">
      
        Quick Start
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Quick Start">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#install-from-marketplace-recommended" class="md-nav__link">
    <span class="md-ellipsis">
      
        Install from Marketplace (recommended)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#development-mode" class="md-nav__link">
    <span class="md-ellipsis">
      
        Development mode
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-it-works" class="md-nav__link">
    <span class="md-ellipsis">
      
        How It Works
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="How It Works">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lifecycle-diagram" class="md-nav__link">
    <span class="md-ellipsis">
      
        Lifecycle Diagram
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hook-summary" class="md-nav__link">
    <span class="md-ellipsis">
      
        Hook Summary
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-each-hook-does" class="md-nav__link">
    <span class="md-ellipsis">
      
        What Each Hook Does
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="What Each Hook Does">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sessionstart" class="md-nav__link">
    <span class="md-ellipsis">
      
        SessionStart
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#userpromptsubmit" class="md-nav__link">
    <span class="md-ellipsis">
      
        UserPromptSubmit
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stop" class="md-nav__link">
    <span class="md-ellipsis">
      
        Stop
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sessionend" class="md-nav__link">
    <span class="md-ellipsis">
      
        SessionEnd
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#progressive-disclosure" class="md-nav__link">
    <span class="md-ellipsis">
      
        Progressive Disclosure
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Progressive Disclosure">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#l1-auto-injected-automatic" class="md-nav__link">
    <span class="md-ellipsis">
      
        L1: Auto-Injected (Automatic)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#l2-on-demand-expand" class="md-nav__link">
    <span class="md-ellipsis">
      
        L2: On-Demand Expand
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#l3-transcript-drill-down" class="md-nav__link">
    <span class="md-ellipsis">
      
        L3: Transcript Drill-Down
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-the-jsonl-looks-like" class="md-nav__link">
    <span class="md-ellipsis">
      
        What the JSONL Looks Like
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#session-anchors" class="md-nav__link">
    <span class="md-ellipsis">
      
        Session Anchors
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memory-storage" class="md-nav__link">
    <span class="md-ellipsis">
      
        Memory Storage
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Memory Storage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#directory-structure" class="md-nav__link">
    <span class="md-ellipsis">
      
        Directory Structure
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-memory-file" class="md-nav__link">
    <span class="md-ellipsis">
      
        Example Memory File
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#markdown-is-the-source-of-truth" class="md-nav__link">
    <span class="md-ellipsis">
      
        Markdown Is the Source of Truth
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#comparison-with-claude-mem" class="md-nav__link">
    <span class="md-ellipsis">
      
        Comparison with claude-mem
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Comparison with claude-mem">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-key-insight-automatic-vs-agent-driven-recall" class="md-nav__link">
    <span class="md-ellipsis">
      
        The Key Insight: Automatic vs. Agent-Driven Recall
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#comparison-with-claudes-native-memory" class="md-nav__link">
    <span class="md-ellipsis">
      
        Comparison with Claude's Native Memory
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Comparison with Claude&#39;s Native Memory">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#why-this-matters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Why This Matters
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#plugin-files" class="md-nav__link">
    <span class="md-ellipsis">
      
        Plugin Files
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Plugin Files">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#file-descriptions" class="md-nav__link">
    <span class="md-ellipsis">
      
        File Descriptions
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-memsearch-cli" class="md-nav__link">
    <span class="md-ellipsis">
      
        The memsearch CLI
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="claude-code-plugin">Claude Code Plugin<a class="headerlink" href="#claude-code-plugin" title="Permanent link">&para;</a></h1>
<p><strong>Automatic persistent memory for Claude Code.</strong> No commands to learn, no manual saving -- just install the plugin and Claude remembers what you worked on across sessions.</p>
<p>The plugin is built entirely on Claude Code's own primitives: <strong>Hooks</strong> for lifecycle events, <strong>CLI</strong> for tool access, and <strong>Agent</strong> for autonomous decisions. No MCP servers, no sidecar services, no extra network round-trips. Everything runs locally as shell scripts and a Python CLI.</p>
<hr />
<h2 id="what-it-does">What It Does<a class="headerlink" href="#what-it-does" title="Permanent link">&para;</a></h2>
<p>When you launch Claude Code with the memsearch plugin:</p>
<ol>
<li><strong>Every session is remembered.</strong> When Claude finishes responding, a Haiku model summarizes the exchange and appends it to a daily markdown log (<code>YYYY-MM-DD.md</code>).</li>
<li><strong>Every prompt triggers recall.</strong> Before Claude sees your message, a semantic search runs against all past memories and injects the most relevant ones into context.</li>
<li><strong>No manual intervention.</strong> You never need to run a command, tag a memory, or tell Claude to "remember this". The hooks handle everything.</li>
</ol>
<p>The result: Claude has a persistent, searchable, ever-growing memory -- without you lifting a finger.</p>
<hr />
<h2 id="quick-start">Quick Start<a class="headerlink" href="#quick-start" title="Permanent link">&para;</a></h2>
<h3 id="install-from-marketplace-recommended">Install from Marketplace (recommended)<a class="headerlink" href="#install-from-marketplace-recommended" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="c1"># 1. Install the memsearch CLI</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>pip<span class="w"> </span>install<span class="w"> </span>memsearch
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="c1"># 2. (Optional) Initialize config</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>memsearch<span class="w"> </span>config<span class="w"> </span>init
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="c1"># 3. In Claude Code, add the marketplace and install the plugin</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>/plugin<span class="w"> </span>marketplace<span class="w"> </span>add<span class="w"> </span>zilliztech/memsearch
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>/plugin<span class="w"> </span>install<span class="w"> </span>memsearch
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="c1"># 4. Have a conversation, then exit. Check your memories:</span>
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>cat<span class="w"> </span>.memsearch/memory/<span class="k">$(</span>date<span class="w"> </span>+%Y-%m-%d<span class="k">)</span>.md
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a><span class="c1"># 5. Start a new session -- Claude automatically remembers!</span>
</code></pre></div>
<h3 id="development-mode">Development mode<a class="headerlink" href="#development-mode" title="Permanent link">&para;</a></h3>
<p>For contributors or if you want to modify the plugin:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/zilliztech/memsearch.git
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>pip<span class="w"> </span>install<span class="w"> </span>memsearch
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>claude<span class="w"> </span>--plugin-dir<span class="w"> </span>./memsearch/ccplugin
</code></pre></div>
<hr />
<h2 id="how-it-works">How It Works<a class="headerlink" href="#how-it-works" title="Permanent link">&para;</a></h2>
<p>The plugin hooks into <strong>4 Claude Code lifecycle events</strong>. A singleton <code>memsearch watch</code> process runs in the background, keeping the vector index in sync with markdown files as they change.</p>
<h3 id="lifecycle-diagram">Lifecycle Diagram<a class="headerlink" href="#lifecycle-diagram" title="Permanent link">&para;</a></h3>
<pre class="mermaid"><code>stateDiagram-v2
    [*] --&gt; SessionStart
    SessionStart --&gt; WatchRunning: start memsearch watch
    SessionStart --&gt; InjectRecent: load recent memories

    state WatchRunning {
        [*] --&gt; Watching
        Watching --&gt; Reindex: file changed
        Reindex --&gt; Watching: done
    }

    InjectRecent --&gt; Prompting

    state Prompting {
        [*] --&gt; UserInput
        UserInput --&gt; SemanticSearch: memsearch search
        SemanticSearch --&gt; InjectMemories: top-k results
        InjectMemories --&gt; ClaudeThinks
        ClaudeThinks --&gt; Summary: haiku summarize
        Summary --&gt; WriteMD: write YYYY-MM-DD.md
        WriteMD --&gt; UserInput: next turn
    }

    Prompting --&gt; SessionEnd: user exits
    SessionEnd --&gt; StopWatch: stop memsearch watch
    StopWatch --&gt; [*]</code></pre>
<h3 id="hook-summary">Hook Summary<a class="headerlink" href="#hook-summary" title="Permanent link">&para;</a></h3>
<p>The plugin defines exactly 4 hooks, all declared in <code>hooks/hooks.json</code>:</p>
<table>
<thead>
<tr>
<th>Hook</th>
<th>Type</th>
<th>Async</th>
<th>Timeout</th>
<th>What It Does</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>SessionStart</strong></td>
<td>command</td>
<td>no</td>
<td>10s</td>
<td>Start <code>memsearch watch</code> singleton, write session heading to today's <code>.md</code>, inject recent memories and Memory Tools instructions via <code>additionalContext</code></td>
</tr>
<tr>
<td><strong>UserPromptSubmit</strong></td>
<td>command</td>
<td>no</td>
<td>15s</td>
<td>Semantic search on user prompt (skip if &lt; 10 chars), inject top-3 relevant memories with <code>chunk_hash</code> IDs via <code>additionalContext</code></td>
</tr>
<tr>
<td><strong>Stop</strong></td>
<td>command</td>
<td><strong>yes</strong></td>
<td>120s</td>
<td>Parse transcript with <code>parse-transcript.sh</code>, call <code>claude -p --model haiku</code> to summarize, append summary with session/turn anchors to daily <code>.md</code></td>
</tr>
<tr>
<td><strong>SessionEnd</strong></td>
<td>command</td>
<td>no</td>
<td>10s</td>
<td>Stop the <code>memsearch watch</code> background process (cleanup)</td>
</tr>
</tbody>
</table>
<h3 id="what-each-hook-does">What Each Hook Does<a class="headerlink" href="#what-each-hook-does" title="Permanent link">&para;</a></h3>
<h4 id="sessionstart">SessionStart<a class="headerlink" href="#sessionstart" title="Permanent link">&para;</a></h4>
<p>Fires once when a Claude Code session begins. This hook:</p>
<ol>
<li><strong>Starts the watcher.</strong> Launches <code>memsearch watch .memsearch/memory/</code> as a singleton background process (PID file lock prevents duplicates). The watcher monitors markdown files and auto-re-indexes on changes with a 1500ms debounce.</li>
<li><strong>Writes a session heading.</strong> Appends <code>## Session HH:MM</code> to today's memory file (<code>.memsearch/memory/YYYY-MM-DD.md</code>), creating the file if it does not exist.</li>
<li><strong>Injects recent memories.</strong> Reads the last 30 lines from the 2 most recent daily logs. If memsearch is available, also runs <code>memsearch search "recent session summary" --top-k 3</code> for semantic results.</li>
<li><strong>Injects Memory Tools instructions.</strong> Tells Claude about <code>memsearch expand</code> and <code>memsearch transcript</code> commands for progressive disclosure (L2 and L3).</li>
</ol>
<p>All of this is returned as <code>additionalContext</code> in the hook output JSON.</p>
<h4 id="userpromptsubmit">UserPromptSubmit<a class="headerlink" href="#userpromptsubmit" title="Permanent link">&para;</a></h4>
<p>Fires on every user prompt before Claude processes it. This hook:</p>
<ol>
<li><strong>Extracts the prompt</strong> from the hook input JSON.</li>
<li><strong>Skips short prompts</strong> (under 10 characters) -- greetings and single words are not worth searching.</li>
<li><strong>Runs semantic search.</strong> Calls <code>memsearch search "$PROMPT" --top-k 3 --json-output</code>.</li>
<li><strong>Formats results</strong> as a compact index with source file, heading, a 200-character preview, and the <code>chunk_hash</code> for each result.</li>
<li><strong>Injects as context.</strong> Returns formatted results under a <code>## Relevant Memories</code> heading via <code>additionalContext</code>.</li>
</ol>
<p>This is the key mechanism that makes memory recall automatic -- Claude does not need to decide to search, it simply receives relevant context on every prompt.</p>
<h4 id="stop">Stop<a class="headerlink" href="#stop" title="Permanent link">&para;</a></h4>
<p>Fires after Claude finishes each response. Runs <strong>asynchronously</strong> so it does not block the user. This hook:</p>
<ol>
<li><strong>Guards against recursion.</strong> Checks <code>stop_hook_active</code> to prevent infinite loops (since the hook itself calls <code>claude -p</code>).</li>
<li><strong>Validates the transcript.</strong> Skips if the transcript file is missing or has fewer than 3 lines.</li>
<li><strong>Parses the transcript.</strong> Calls <code>parse-transcript.sh</code>, which:<ul>
<li>Takes the last 200 lines of the JSONL transcript</li>
<li>Truncates user/assistant text to 500 characters each</li>
<li>Extracts tool names with input summaries</li>
<li>Skips <code>file-history-snapshot</code> entries</li>
</ul>
</li>
<li><strong>Summarizes with Haiku.</strong> Pipes the parsed transcript to <code>claude -p --model haiku --no-session-persistence</code> with a system prompt that requests 3-8 bullet points focusing on decisions, problems solved, code changes, and key findings.</li>
<li><strong>Appends to daily log.</strong> Writes a <code>### HH:MM</code> sub-heading with an HTML comment anchor containing session ID, turn UUID, and transcript path. Then explicitly runs <code>memsearch index</code> to ensure the new content is indexed immediately, rather than relying on the watcher's debounce timer (which may not fire before SessionEnd kills the watcher).</li>
</ol>
<h4 id="sessionend">SessionEnd<a class="headerlink" href="#sessionend" title="Permanent link">&para;</a></h4>
<p>Fires when the user exits Claude Code. Simply calls <code>stop_watch</code> to kill the <code>memsearch watch</code> process and clean up the PID file, including a sweep for any orphaned processes.</p>
<hr />
<h2 id="progressive-disclosure">Progressive Disclosure<a class="headerlink" href="#progressive-disclosure" title="Permanent link">&para;</a></h2>
<p>Memory retrieval uses a <strong>three-layer progressive disclosure model</strong>. Layer 1 is fully automatic; layers 2 and 3 are available on demand when Claude needs more context.</p>
<pre class="mermaid"><code>graph TD
    L1["L1: Auto-injected&lt;br/&gt;(UserPromptSubmit hook)"] --&gt; L2["L2: On-demand expand&lt;br/&gt;(memsearch expand)"]
    L2 --&gt; L3["L3: Transcript drill-down&lt;br/&gt;(memsearch transcript)"]

    style L1 fill:#2a3a5c,stroke:#6ba3d6,color:#a8b2c1
    style L2 fill:#2a3a5c,stroke:#e0976b,color:#a8b2c1
    style L3 fill:#2a3a5c,stroke:#d66b6b,color:#a8b2c1</code></pre>
<h3 id="l1-auto-injected-automatic">L1: Auto-Injected (Automatic)<a class="headerlink" href="#l1-auto-injected-automatic" title="Permanent link">&para;</a></h3>
<p>On every user prompt, the <code>UserPromptSubmit</code> hook injects the top-3 semantic search results. Each result includes:</p>
<ul>
<li>Source file and heading</li>
<li>A 200-character content preview</li>
<li>The <code>chunk_hash</code> identifier</li>
</ul>
<p>This happens transparently -- no action from Claude or the user is required.</p>
<p><strong>Example injection</strong> (this is what Claude sees before processing each message):</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>## Relevant Memories
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>- [.memsearch/memory/2026-02-12.md:04:16]  使用远程 Milvus Server 测试
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>  `claude -p` 模式，索引了 4 个 chunks，search 正常返回相关结果。确认
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>  `claude -p` 模式不触发任何 hooks...
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>  `chunk_hash: 47b5475122b992b6`
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>- [.memsearch/memory/2026-02-11.md:11:02]  修复 watch 启动时不索引已有文件的
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>  问题。ccplugin stop.sh 增加显式 memsearch index 调用...
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>  `chunk_hash: 31cbaf74856ad1ed`
</code></pre></div>
<p>The preview is enough for Claude to answer most follow-up questions. But when it needs the full picture, it moves to L2.</p>
<h3 id="l2-on-demand-expand">L2: On-Demand Expand<a class="headerlink" href="#l2-on-demand-expand" title="Permanent link">&para;</a></h3>
<p>When an L1 preview is not enough, Claude runs <code>memsearch expand</code> to retrieve the <strong>full markdown section</strong> surrounding a chunk:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>$<span class="w"> </span>memsearch<span class="w"> </span>expand<span class="w"> </span>47b5475122b992b6
</code></pre></div>
<p><strong>Example output:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>Source: .memsearch/memory/2026-02-12.md (lines 96-111)
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>Heading: 04:16
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>Session: 433f8bc3-a5a8-46a2-8285-71941dc96ad0
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>Turn: 8ee6995b-2e7c-4e11-92e2-6f07fdfb55c7
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>Transcript: /home/user/.claude/projects/.../433f8bc3...46a0.jsonl
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a>### 04:13
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a>&lt;!-- session:433f8bc3... turn:0a0df619... transcript:/.../433f8bc3...46a0.jsonl --&gt;
<a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a>- `claude -p` 模式不触发 SessionStart 和 UserPromptSubmit hooks
<a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a>- hooks 依赖正常交互模式
<a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a>- Milvus Server 可用，连接到 http://10.100.30.11:19530 验证通过
<a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a>- 本地 Milvus Lite 测试完成，index 了 4 个 chunks
<a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a>
<a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a>### 04:16
<a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a>&lt;!-- session:433f8bc3... turn:8ee6995b... transcript:/.../433f8bc3...46a0.jsonl --&gt;
<a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a>- 使用远程 Milvus Server 测试 `claude -p` 模式，索引了 4 个 chunks
<a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a>- 确认 `claude -p` 模式不触发任何 hooks
<a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a>- 正确的测试方式应该用交互模式 `claude` 而非 `-p` 标志
<a id="__codelineno-4-19" name="__codelineno-4-19" href="#__codelineno-4-19"></a>- 远程 Milvus Server 可用，collection stats 显示 0（已知的 flush 延迟问题）
</code></pre></div>
<p>Now Claude sees the full context including the neighboring <code>### 04:13</code> section. The embedded <code>&lt;!-- session:... --&gt;</code> anchors link to the original conversation -- if Claude needs to go even deeper, it moves to L3.</p>
<p>Additional flags:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="c1"># JSON output with anchor metadata (for programmatic L3 drill-down)</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>memsearch<span class="w"> </span>expand<span class="w"> </span>47b5475122b992b6<span class="w"> </span>--json-output
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="c1"># Show N lines of context before/after instead of the full section</span>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>memsearch<span class="w"> </span>expand<span class="w"> </span>47b5475122b992b6<span class="w"> </span>--lines<span class="w"> </span><span class="m">10</span>
</code></pre></div>
<h3 id="l3-transcript-drill-down">L3: Transcript Drill-Down<a class="headerlink" href="#l3-transcript-drill-down" title="Permanent link">&para;</a></h3>
<p>When Claude needs the original conversation verbatim -- for instance, to recall exact code snippets, error messages, or tool outputs -- it drills into the JSONL transcript.</p>
<p><strong>List all turns</strong> in a session:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>$<span class="w"> </span>memsearch<span class="w"> </span>transcript<span class="w"> </span>/path/to/session.jsonl
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>All turns (73):
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>  6d6210b7-b84  15:15:14  Implement the following plan: ...              [20 tools]
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>  3075ee94-0f6  15:20:10  这个ccplugin的例子还要讲要准备 API key...
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>  8e45ce0d-9a0  15:23:16  /plugin install memsearch 后面要注释下...       [2 tools]
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>  53f5cac3-6d9  15:27:07  claude-mem 链接好像打不开...                    [9 tools]
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>  c708b40c-8f8  15:30:45  这些改动提交下push然后提个pr...                [10 tools]
</code></pre></div>
<p>Each line shows the turn UUID prefix, timestamp, content preview, and how many tool calls occurred.</p>
<p><strong>Drill into a specific turn</strong> with surrounding context:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>$<span class="w"> </span>memsearch<span class="w"> </span>transcript<span class="w"> </span>/path/to/session.jsonl<span class="w"> </span>--turn<span class="w"> </span>6d6210b7<span class="w"> </span>--context<span class="w"> </span><span class="m">1</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>Showing 2 turns around 6d6210b7:
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>&gt;&gt;&gt; [15:15:14] 6d6210b7
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>Implement the following plan:
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a>
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a># Plan: Slim down README, link to docs site
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a>
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a>## Context
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a>README 中 CLI Usage、Configuration、Embedding Providers 等章节与文档站
<a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a>内容高度重复。精简 README 保留核心亮点，详细内容链接到文档站。
<a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a>...
<a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a>
<a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a>**Assistant**: 现在我来看看文档站的锚点，确保链接正确。
</code></pre></div>
<p>This recovers the full original conversation -- user messages, assistant responses, and tool call summaries -- so Claude can recall exactly what happened during a past session.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="c1"># JSON output for programmatic use</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>memsearch<span class="w"> </span>transcript<span class="w"> </span>/path/to/session.jsonl<span class="w"> </span>--turn<span class="w"> </span>6d6210b7<span class="w"> </span>--json-output
</code></pre></div>
<h3 id="what-the-jsonl-looks-like">What the JSONL Looks Like<a class="headerlink" href="#what-the-jsonl-looks-like" title="Permanent link">&para;</a></h3>
<p>The transcript files are standard <a href="https://jsonlines.org/">JSON Lines</a> -- one JSON object per line. Claude Code writes every message, tool call, and tool result as a separate line. Here is what the key message types look like (abbreviated for readability):</p>
<p><strong>User message</strong> (human input):</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="p">{</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;user&quot;</span><span class="p">,</span>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="w">  </span><span class="nt">&quot;uuid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;6d6210b7-b841-4cd7-a97f-e3c8bb185d06&quot;</span><span class="p">,</span>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="w">  </span><span class="nt">&quot;parentUuid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;8404eaca-3926-4765-bcb9-6ca4befae466&quot;</span><span class="p">,</span>
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="w">  </span><span class="nt">&quot;sessionId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;433f8bc3-a5a8-46a2-8285-71941dc96ad0&quot;</span><span class="p">,</span>
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a><span class="w">  </span><span class="nt">&quot;timestamp&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2026-02-11T15:15:14.284Z&quot;</span><span class="p">,</span>
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a><span class="w">  </span><span class="nt">&quot;message&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a><span class="w">    </span><span class="nt">&quot;role&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;user&quot;</span><span class="p">,</span>
<a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a><span class="w">    </span><span class="nt">&quot;content&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Implement the following plan: ...&quot;</span>
<a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a><span class="p">}</span>
</code></pre></div>
<p><strong>Assistant message</strong> (text response):</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="p">{</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;assistant&quot;</span><span class="p">,</span>
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="w">  </span><span class="nt">&quot;uuid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;32da9357-1efe-4985-8a6e-4864bbf58951&quot;</span><span class="p">,</span>
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="w">  </span><span class="nt">&quot;parentUuid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;d99f255c-6ac7-43fa-bcc8-c0dabc4c65cf&quot;</span><span class="p">,</span>
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="w">  </span><span class="nt">&quot;sessionId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;433f8bc3-a5a8-46a2-8285-71941dc96ad0&quot;</span><span class="p">,</span>
<a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a><span class="w">  </span><span class="nt">&quot;timestamp&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2026-02-11T15:15:36.510Z&quot;</span><span class="p">,</span>
<a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a><span class="w">  </span><span class="nt">&quot;message&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a><span class="w">    </span><span class="nt">&quot;role&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;assistant&quot;</span><span class="p">,</span>
<a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a><span class="w">    </span><span class="nt">&quot;content&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a><span class="w">      </span><span class="p">{</span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;text&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;text&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;好的，让我开始编辑 README.md。&quot;</span><span class="p">}</span>
<a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a><span class="w">    </span><span class="p">]</span>
<a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-12-13" name="__codelineno-12-13" href="#__codelineno-12-13"></a><span class="p">}</span>
</code></pre></div>
<p><strong>Assistant message</strong> (tool call):</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="p">{</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;assistant&quot;</span><span class="p">,</span>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="w">  </span><span class="nt">&quot;uuid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;35fa9333-02ff-4b07-9036-ec0e3e290602&quot;</span><span class="p">,</span>
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="w">  </span><span class="nt">&quot;parentUuid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;7ab167db-9a57-4f51-b5d3-eb63a2e6a5ad&quot;</span><span class="p">,</span>
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="w">  </span><span class="nt">&quot;sessionId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;433f8bc3-a5a8-46a2-8285-71941dc96ad0&quot;</span><span class="p">,</span>
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="w">  </span><span class="nt">&quot;timestamp&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2026-02-11T15:15:20.992Z&quot;</span><span class="p">,</span>
<a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a><span class="w">  </span><span class="nt">&quot;message&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a><span class="w">    </span><span class="nt">&quot;role&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;assistant&quot;</span><span class="p">,</span>
<a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a><span class="w">    </span><span class="nt">&quot;content&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a><span class="w">      </span><span class="p">{</span>
<a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a><span class="w">        </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;tool_use&quot;</span><span class="p">,</span>
<a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a><span class="w">        </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;toolu_014CPfherKZMyYbbG5VT4dyX&quot;</span><span class="p">,</span>
<a id="__codelineno-13-13" name="__codelineno-13-13" href="#__codelineno-13-13"></a><span class="w">        </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Read&quot;</span><span class="p">,</span>
<a id="__codelineno-13-14" name="__codelineno-13-14" href="#__codelineno-13-14"></a><span class="w">        </span><span class="nt">&quot;input&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">&quot;file_path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/path/to/README.md&quot;</span><span class="p">}</span>
<a id="__codelineno-13-15" name="__codelineno-13-15" href="#__codelineno-13-15"></a><span class="w">      </span><span class="p">}</span>
<a id="__codelineno-13-16" name="__codelineno-13-16" href="#__codelineno-13-16"></a><span class="w">    </span><span class="p">]</span>
<a id="__codelineno-13-17" name="__codelineno-13-17" href="#__codelineno-13-17"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-13-18" name="__codelineno-13-18" href="#__codelineno-13-18"></a><span class="p">}</span>
</code></pre></div>
<p><strong>Tool result</strong> (returned to assistant as a user message):</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="p">{</span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;user&quot;</span><span class="p">,</span>
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="w">  </span><span class="nt">&quot;uuid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;7dd5ac66-c848-4e39-952a-511c94ac66f2&quot;</span><span class="p">,</span>
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="w">  </span><span class="nt">&quot;parentUuid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;35fa9333-02ff-4b07-9036-ec0e3e290602&quot;</span><span class="p">,</span>
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="w">  </span><span class="nt">&quot;sessionId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;433f8bc3-a5a8-46a2-8285-71941dc96ad0&quot;</span><span class="p">,</span>
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="w">  </span><span class="nt">&quot;timestamp&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2026-02-11T15:15:21.005Z&quot;</span><span class="p">,</span>
<a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a><span class="w">  </span><span class="nt">&quot;message&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a><span class="w">    </span><span class="nt">&quot;role&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;user&quot;</span><span class="p">,</span>
<a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a><span class="w">    </span><span class="nt">&quot;content&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a><span class="w">      </span><span class="p">{</span>
<a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a><span class="w">        </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;tool_result&quot;</span><span class="p">,</span>
<a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a><span class="w">        </span><span class="nt">&quot;tool_use_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;toolu_014CPfherKZMyYbbG5VT4dyX&quot;</span><span class="p">,</span>
<a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a><span class="w">        </span><span class="nt">&quot;content&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;     1→# memsearch\n     2→\n     3→...&quot;</span>
<a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a><span class="w">      </span><span class="p">}</span>
<a id="__codelineno-14-15" name="__codelineno-14-15" href="#__codelineno-14-15"></a><span class="w">    </span><span class="p">]</span>
<a id="__codelineno-14-16" name="__codelineno-14-16" href="#__codelineno-14-16"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-14-17" name="__codelineno-14-17" href="#__codelineno-14-17"></a><span class="p">}</span>
</code></pre></div>
<p>Key fields:</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>type</code></td>
<td>Message type: <code>user</code>, <code>assistant</code>, <code>progress</code>, <code>system</code>, <code>file-history-snapshot</code></td>
</tr>
<tr>
<td><code>uuid</code></td>
<td>Unique ID for this message</td>
</tr>
<tr>
<td><code>parentUuid</code></td>
<td>ID of the previous message (forms a linked chain)</td>
</tr>
<tr>
<td><code>sessionId</code></td>
<td>Session ID (matches the JSONL filename)</td>
</tr>
<tr>
<td><code>timestamp</code></td>
<td>ISO 8601 timestamp</td>
</tr>
<tr>
<td><code>message.content</code></td>
<td>String for user text, or array of <code>text</code> / <code>tool_use</code> / <code>tool_result</code> blocks</td>
</tr>
</tbody>
</table>
<div class="admonition tip">
<p class="admonition-title">You don't need to parse JSONL manually</p>
<p>The <code>memsearch transcript</code> command handles all the parsing, truncation, and formatting. The JSONL structure is documented here for transparency -- most users will never need to read these files directly.</p>
</div>
<h3 id="session-anchors">Session Anchors<a class="headerlink" href="#session-anchors" title="Permanent link">&para;</a></h3>
<p>Each memory summary includes an HTML comment anchor that links the chunk back to its source session, enabling the L2-to-L3 drill-down:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="gu">### 14:30</span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>&lt;!-- session:abc123def turn:ghi789jkl transcript:/home/user/.claude/projects/.../abc123def.jsonl --&gt;
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="k">-</span><span class="w"> </span>Implemented caching system with Redis L1 and in-process LRU L2
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="k">-</span><span class="w"> </span>Fixed N+1 query issue in order-service using selectinload
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="k">-</span><span class="w"> </span>Decided to use Prometheus counters for cache hit/miss metrics
</code></pre></div>
<p>The anchor contains three fields:</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>session</code></td>
<td>Claude Code session ID (also the JSONL filename without extension)</td>
</tr>
<tr>
<td><code>turn</code></td>
<td>UUID of the last user turn in the session</td>
</tr>
<tr>
<td><code>transcript</code></td>
<td>Absolute path to the JSONL transcript file</td>
</tr>
</tbody>
</table>
<p>Claude extracts these fields from <code>memsearch expand --json-output</code> and uses them to call <code>memsearch transcript</code> for L3 access.</p>
<hr />
<h2 id="memory-storage">Memory Storage<a class="headerlink" href="#memory-storage" title="Permanent link">&para;</a></h2>
<p>All memories live in <strong><code>.memsearch/memory/</code></strong> inside your project directory.</p>
<h3 id="directory-structure">Directory Structure<a class="headerlink" href="#directory-structure" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>your-project/
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>├── .memsearch/
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>│   ├── .watch.pid            &lt;-- singleton watcher PID file
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>│   └── memory/
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a>│       ├── 2026-02-07.md     &lt;-- daily memory log
<a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a>│       ├── 2026-02-08.md
<a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a>│       └── 2026-02-09.md     &lt;-- today&#39;s session summaries
<a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a>└── ... (your project files)
</code></pre></div>
<h3 id="example-memory-file">Example Memory File<a class="headerlink" href="#example-memory-file" title="Permanent link">&para;</a></h3>
<p>A typical daily memory file (<code>2026-02-09.md</code>) looks like this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="gu">## Session 14:30</span>
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="gu">### 14:30</span>
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a>&lt;!-- session:abc123def turn:ghi789jkl transcript:/home/user/.claude/projects/.../abc123def.jsonl --&gt;
<a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="k">-</span><span class="w"> </span>Implemented caching system with Redis L1 and in-process LRU L2
<a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a><span class="k">-</span><span class="w"> </span>Fixed N+1 query issue in order-service using selectinload
<a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a><span class="k">-</span><span class="w"> </span>Decided to use Prometheus counters for cache hit/miss metrics
<a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a>
<a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a><span class="gu">## Session 17:45</span>
<a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a>
<a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a><span class="gu">### 17:45</span>
<a id="__codelineno-17-12" name="__codelineno-17-12" href="#__codelineno-17-12"></a>&lt;!-- session:mno456pqr turn:stu012vwx transcript:/home/user/.claude/projects/.../mno456pqr.jsonl --&gt;
<a id="__codelineno-17-13" name="__codelineno-17-13" href="#__codelineno-17-13"></a><span class="k">-</span><span class="w"> </span>Debugged React hydration mismatch caused by Date.now() during SSR
<a id="__codelineno-17-14" name="__codelineno-17-14" href="#__codelineno-17-14"></a><span class="k">-</span><span class="w"> </span>Added comprehensive test suite for the caching middleware
<a id="__codelineno-17-15" name="__codelineno-17-15" href="#__codelineno-17-15"></a><span class="k">-</span><span class="w"> </span>Reviewed PR <span class="ni">#42:</span> approved with minor naming suggestions
</code></pre></div>
<p>Each file accumulates all sessions from that day. The format is plain markdown -- human-readable, <code>grep</code>-able, and git-friendly.</p>
<h3 id="markdown-is-the-source-of-truth">Markdown Is the Source of Truth<a class="headerlink" href="#markdown-is-the-source-of-truth" title="Permanent link">&para;</a></h3>
<p>The Milvus vector index is a <strong>derived cache</strong> that can be rebuilt at any time:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>memsearch<span class="w"> </span>index<span class="w"> </span>.memsearch/memory/
</code></pre></div>
<p>This means:</p>
<ul>
<li><strong>No data loss.</strong> Even if Milvus is corrupted or deleted, your memories are safe in <code>.md</code> files.</li>
<li><strong>Portable.</strong> Copy <code>.memsearch/memory/</code> to another machine and rebuild the index.</li>
<li><strong>Auditable.</strong> You can read, edit, or delete any memory entry with a text editor.</li>
<li><strong>Git-friendly.</strong> Commit your memory files to version control for a complete project history.</li>
</ul>
<hr />
<h2 id="comparison-with-claude-mem">Comparison with claude-mem<a class="headerlink" href="#comparison-with-claude-mem" title="Permanent link">&para;</a></h2>
<p><a href="https://github.com/thedotmack/claude-mem">claude-mem</a> is another memory solution for Claude Code. Here is a detailed comparison:</p>
<table>
<thead>
<tr>
<th>Aspect</th>
<th>memsearch</th>
<th>claude-mem</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Architecture</strong></td>
<td>4 shell hooks + 1 watch process</td>
<td>Node.js/Bun worker service + Express server + React UI</td>
</tr>
<tr>
<td><strong>Integration</strong></td>
<td>Native hooks + CLI (zero IPC overhead)</td>
<td>MCP server (stdio); tool definitions permanently consume context window</td>
</tr>
<tr>
<td><strong>Memory recall</strong></td>
<td><strong>Automatic</strong> -- semantic search on every prompt via hook</td>
<td><strong>Agent-driven</strong> -- Claude must explicitly call MCP <code>search</code> tool</td>
</tr>
<tr>
<td><strong>Progressive disclosure</strong></td>
<td><strong>3-layer, auto-triggered</strong>: hook injects top-k (L1), then <code>expand</code> (L2), then <code>transcript</code> (L3)</td>
<td><strong>3-layer, all manual</strong>: <code>search</code>, <code>timeline</code>, <code>get_observations</code> all require explicit tool calls</td>
</tr>
<tr>
<td><strong>Session summary cost</strong></td>
<td>1 <code>claude -p --model haiku</code> call, runs async</td>
<td>Observation on every tool use + session summary (more API calls at scale)</td>
</tr>
<tr>
<td><strong>Vector backend</strong></td>
<td>Milvus -- hybrid search (dense + BM25), scales from embedded to distributed cluster</td>
<td>Chroma -- dense only, limited scaling path</td>
</tr>
<tr>
<td><strong>Storage format</strong></td>
<td>Transparent <code>.md</code> files -- human-readable, git-friendly</td>
<td>Opaque SQLite + Chroma binary</td>
</tr>
<tr>
<td><strong>Index sync</strong></td>
<td><code>memsearch watch</code> singleton -- auto-debounced background sync</td>
<td>Automatic observation writes, but no unified background sync</td>
</tr>
<tr>
<td><strong>Data portability</strong></td>
<td>Copy <code>.memsearch/memory/*.md</code> and rebuild</td>
<td>Export from SQLite + Chroma</td>
</tr>
<tr>
<td><strong>Runtime dependency</strong></td>
<td>Python (<code>memsearch</code> CLI) + <code>claude</code> CLI</td>
<td>Node.js + Bun + MCP runtime</td>
</tr>
<tr>
<td><strong>Context window cost</strong></td>
<td>Minimal -- hook injects only top-k results as plain text</td>
<td>MCP tool definitions always loaded + each tool call/result consumes context</td>
</tr>
<tr>
<td><strong>Cost per session</strong></td>
<td>~1 Haiku call for summary</td>
<td>Multiple Claude API calls for observation compression</td>
</tr>
</tbody>
</table>
<h3 id="the-key-insight-automatic-vs-agent-driven-recall">The Key Insight: Automatic vs. Agent-Driven Recall<a class="headerlink" href="#the-key-insight-automatic-vs-agent-driven-recall" title="Permanent link">&para;</a></h3>
<p>The fundamental architectural difference is <strong>when</strong> memory recall happens.</p>
<p><strong>memsearch injects relevant memories into every prompt via hooks.</strong> Claude does not need to decide whether to search -- it simply receives relevant context before processing each message. This means memories are <strong>never missed due to Claude forgetting to look them up</strong>. Progressive disclosure starts automatically at L1 (the hook injects top-k results), and only deeper layers (L2 expand, L3 transcript) require explicit CLI calls from the agent.</p>
<p><strong>claude-mem gives Claude MCP tools to search, explore timelines, and fetch observations.</strong> All three layers require Claude to <strong>proactively decide</strong> to invoke them. While this is more flexible (Claude controls when and what to recall), it means memories are only retrieved when Claude thinks to ask. In practice, Claude often does not call the search tool unless the conversation explicitly references past work -- which means relevant context can be silently lost.</p>
<p>The difference is analogous to push vs. pull: memsearch <strong>pushes</strong> memories to Claude on every turn, while claude-mem requires Claude to <strong>pull</strong> them on demand.</p>
<hr />
<h2 id="comparison-with-claudes-native-memory">Comparison with Claude's Native Memory<a class="headerlink" href="#comparison-with-claudes-native-memory" title="Permanent link">&para;</a></h2>
<p>Claude Code has built-in memory features: <code>CLAUDE.md</code> files and auto-memory (the <code>/memory</code> command). Here is why memsearch provides a stronger solution:</p>
<table>
<thead>
<tr>
<th>Aspect</th>
<th>Claude Native Memory</th>
<th>memsearch</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Storage</strong></td>
<td>Single <code>CLAUDE.md</code> file (or per-project)</td>
<td>Unlimited daily <code>.md</code> files with full history</td>
</tr>
<tr>
<td><strong>Recall mechanism</strong></td>
<td>File is loaded at session start (no search)</td>
<td>Semantic search on every prompt (embedding-based)</td>
</tr>
<tr>
<td><strong>Granularity</strong></td>
<td>One monolithic file, manually edited</td>
<td>Per-session bullet points, automatically generated</td>
</tr>
<tr>
<td><strong>Search</strong></td>
<td>None -- Claude reads the whole file or nothing</td>
<td>Hybrid semantic search (dense + BM25) returning top-k relevant chunks</td>
</tr>
<tr>
<td><strong>History depth</strong></td>
<td>Limited to what fits in one file</td>
<td>Unlimited -- every session is logged, every entry is searchable</td>
</tr>
<tr>
<td><strong>Automatic capture</strong></td>
<td><code>/memory</code> command requires manual intervention</td>
<td>Fully automatic -- hooks capture every session</td>
</tr>
<tr>
<td><strong>Progressive disclosure</strong></td>
<td>None -- entire file is loaded into context</td>
<td>3-layer model (L1 auto-inject, L2 expand, L3 transcript) minimizes context usage</td>
</tr>
<tr>
<td><strong>Deduplication</strong></td>
<td>Manual -- user must avoid adding duplicates</td>
<td>SHA-256 content hashing prevents duplicate embeddings</td>
</tr>
<tr>
<td><strong>Portability</strong></td>
<td>Tied to Claude Code's internal format</td>
<td>Standard markdown files, usable with any tool</td>
</tr>
</tbody>
</table>
<h3 id="why-this-matters">Why This Matters<a class="headerlink" href="#why-this-matters" title="Permanent link">&para;</a></h3>
<p><code>CLAUDE.md</code> is a blunt instrument: it loads the entire file into context at session start, regardless of relevance. As the file grows, it wastes context window on irrelevant information and eventually hits size limits. There is no search -- Claude cannot selectively recall a specific decision from three weeks ago.</p>
<p>memsearch solves this with <strong>semantic search and progressive disclosure</strong>. Instead of loading everything, it injects only the top-k most relevant memories for each specific prompt. History can grow indefinitely without degrading performance, because the vector index handles the filtering. And the three-layer model means Claude starts with lightweight previews and only drills deeper when needed, keeping context window usage minimal.</p>
<hr />
<h2 id="plugin-files">Plugin Files<a class="headerlink" href="#plugin-files" title="Permanent link">&para;</a></h2>
<p>The plugin lives in the <code>ccplugin/</code> directory at the root of the memsearch repository:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>ccplugin/
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>├── .claude-plugin/
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a>│   └── plugin.json              # Plugin manifest (name, version, description)
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a>└── hooks/
<a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a>    ├── hooks.json               # Hook definitions (4 lifecycle hooks)
<a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a>    ├── common.sh                # Shared setup: env, PATH, memsearch detection, watch management
<a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a>    ├── session-start.sh         # Start watch + write session heading + inject memories &amp; tools
<a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a>    ├── user-prompt-submit.sh    # Semantic search on prompt -&gt; inject memories with chunk_hash
<a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a>    ├── stop.sh                  # Parse transcript -&gt; haiku summary -&gt; append to daily .md
<a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a>    ├── parse-transcript.sh      # Deterministic JSONL-to-text parser with truncation
<a id="__codelineno-19-11" name="__codelineno-19-11" href="#__codelineno-19-11"></a>    └── session-end.sh           # Stop watch process (cleanup)
</code></pre></div>
<h3 id="file-descriptions">File Descriptions<a class="headerlink" href="#file-descriptions" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>File</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>plugin.json</code></td>
<td>Claude Code plugin manifest. Declares the plugin name (<code>memsearch</code>), version, and description.</td>
</tr>
<tr>
<td><code>hooks.json</code></td>
<td>Defines the 4 lifecycle hooks (SessionStart, UserPromptSubmit, Stop, SessionEnd) with their types, timeouts, and async flags.</td>
</tr>
<tr>
<td><code>common.sh</code></td>
<td>Shared shell library sourced by all hooks. Handles stdin JSON parsing, PATH setup, memsearch binary detection (prefers PATH, falls back to <code>uv run</code>), memory directory management, and the watch singleton (start/stop with PID file and orphan cleanup).</td>
</tr>
<tr>
<td><code>session-start.sh</code></td>
<td>SessionStart hook implementation. Starts the watcher, writes the session heading, reads recent memory files, runs a semantic search for recent context, and injects Memory Tools instructions.</td>
</tr>
<tr>
<td><code>user-prompt-submit.sh</code></td>
<td>UserPromptSubmit hook implementation. Extracts the user prompt, runs <code>memsearch search</code> with <code>--top-k 3 --json-output</code>, and formats results with <code>chunk_hash</code> for progressive disclosure.</td>
</tr>
<tr>
<td><code>stop.sh</code></td>
<td>Stop hook implementation. Extracts the transcript path, validates it, delegates parsing to <code>parse-transcript.sh</code>, calls Haiku for summarization, and appends the result with session anchors to the daily memory file.</td>
</tr>
<tr>
<td><code>parse-transcript.sh</code></td>
<td>Standalone transcript parser. Processes the last 200 lines of a JSONL transcript, truncates content to 500 characters, extracts tool call summaries, and skips file-history-snapshot entries. Used by <code>stop.sh</code>.</td>
</tr>
<tr>
<td><code>session-end.sh</code></td>
<td>SessionEnd hook implementation. Calls <code>stop_watch</code> to terminate the background watcher and clean up.</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="the-memsearch-cli">The <code>memsearch</code> CLI<a class="headerlink" href="#the-memsearch-cli" title="Permanent link">&para;</a></h2>
<p>The plugin is built entirely on the <code>memsearch</code> CLI -- every hook is a shell script calling <code>memsearch</code> subcommands. Here are the commands most relevant to the plugin:</p>
<table>
<thead>
<tr>
<th>Command</th>
<th>Used By</th>
<th>What It Does</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>search &lt;query&gt;</code></td>
<td>UserPromptSubmit hook</td>
<td>Semantic search over indexed memories (<code>--top-k</code> for result count, <code>--json-output</code> for JSON)</td>
</tr>
<tr>
<td><code>watch &lt;paths&gt;</code></td>
<td>SessionStart hook</td>
<td>Background watcher that auto-indexes on file changes (1500ms debounce)</td>
</tr>
<tr>
<td><code>index &lt;paths&gt;</code></td>
<td>Manual / rebuild</td>
<td>One-shot index of markdown files (<code>--force</code> to re-index all)</td>
</tr>
<tr>
<td><code>expand &lt;chunk_hash&gt;</code></td>
<td>Agent (L2 disclosure)</td>
<td>Show full markdown section around a chunk, with anchor metadata</td>
</tr>
<tr>
<td><code>transcript &lt;jsonl&gt;</code></td>
<td>Agent (L3 disclosure)</td>
<td>Parse Claude Code JSONL transcript into readable conversation turns</td>
</tr>
<tr>
<td><code>config init</code></td>
<td>Quick Start</td>
<td>Interactive config wizard for first-time setup</td>
</tr>
<tr>
<td><code>stats</code></td>
<td>Manual</td>
<td>Show index statistics (collection size, chunk count)</td>
</tr>
<tr>
<td><code>reset</code></td>
<td>Manual</td>
<td>Drop all indexed data (requires <code>--yes</code> to confirm)</td>
</tr>
</tbody>
</table>
<p>For the full CLI reference, see the <a href="../cli/">CLI Reference</a> page.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.top", "search.highlight", "content.code.copy"], "search": "../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>